# PC Agent (MVP)

Локальный агент-оператор ПК для Windows 10/11 на Python 3.10+. Агент принимает запрос, обращается к LLM в LM Studio (OpenAI-compatible), выполняет действия через инструменты и возвращает результаты с диагностикой.

## LM Studio
1. Запустите LM Studio и включите локальный сервер (OpenAI-compatible) на `http://localhost:1234`.
2. Убедитесь, что модель загружена и сервер отвечает.

## Выбор модели
По умолчанию используется `MODEL_NAME=local-model`. Можно указать переменную окружения:

```bash
set MODEL_NAME=your-model-name
```

## Установка зависимостей

```bash
python -m venv .venv
.venv\Scripts\activate
pip install -r requirements.txt
```

> Примечание: `opencv-python` опционален. Если он не установлен, `locate_on_screen` вернет ошибку `opencv not installed`.

## Запуск

```bash
python app.py
```

## Примеры запросов
1. "Открой калькулятор"
2. "Открой блокнот и напечатай: привет"
3. "Открой браузер и введи в адресную строку google.com" (через hotkey/typing)
4. "Сделай скриншот рабочего стола"
5. "Открой Яндекс Музыку" (открывает установленное приложение через меню Пуск)
6. "Открой сайт https://music.yandex.ru" (одно подтверждение -> открытие -> финальный ответ без повторов)

## Зачем делаются скриншоты
После большинства действий (открытие приложения/URL, команды ОС, клики и ввод текста) агент сохраняет скриншот в папку `screenshots/`.

Сейчас скриншоты нужны как:
- **доказательство результата** (открылось/не открылось)
- **диагностика ошибок** (видно, куда кликнуло и что на экране)
- **основа для будущего** (OCR/vision-модель сможет читать экран и понимать, что произошло)

Скриншоты можно просмотреть командой `/screens`.

## Логи
Все запросы, подтверждения и результаты инструментов пишутся в `logs/session_*.jsonl`.

## Кэш приложений
Агент хранит способы запуска приложений в `app_paths.json` в корне проекта. Если приложение уже открывалось, повторный запрос (например, "Открой Яндекс Музыку") запускается быстрее и без повторного поиска.

Как очистить запись:
- удалить файл `app_paths.json` целиком, чтобы сбросить весь кэш;
- удалить конкретный ключ из JSON, чтобы сбросить одно приложение.

## Команды CLI
- `/help` — показать справку
- `/exit` — выход
- `/reset` — сбросить контекст
- `/screens` — список последних скриншотов

## Безопасность
Все действия управления ПК требуют подтверждения в консоли. Отказ блокирует выполнение и возвращает `user_denied`.
